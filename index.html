<!DOCTYPE html>
<html style="width:100%;height:100%;">
    <head>
        <meta charset="utf-8">
        <title>Force-Directed Graph</title>
        <script src="https://d3js.org/d3.v4.min.js"></script>
    </head>
    <style>
    
    .links line {
      stroke: #999;
      stroke-opacity: 0.6;
    }
    
    .nodes circle {
      stroke: #fff;
      stroke-width: 1.5px;
    }
    
    </style>
    <body style="width:100%;height:100%;">
        <p id="boorkmarklet"><a href="javascript:(function()%7Bjavascript%3A%20(async%20()%20%3D%3E%20%7B%0A%20%20async%20function%20getUserInfo(username%20%3D%20%22%22)%20%7B%0A%20%20%20%20if%20(!username)%20throw%20new%20Error(%22Username%20is%20required%22)%3B%0A%20%20%20%20try%20%7B%0A%20%20%20%20%20%20let%20followers%20%3D%20%5B%7B%20username%3A%20%22%22%2C%20full_name%3A%20%22%22%20%7D%5D%3B%0A%20%20%20%20%20%20let%20followings%20%3D%20%5B%7B%20username%3A%20%22%22%2C%20full_name%3A%20%22%22%20%7D%5D%3B%0A%0A%20%20%20%20%20%20followers%20%3D%20%5B%5D%3B%0A%20%20%20%20%20%20followings%20%3D%20%5B%5D%3B%0A%20%20%20%20%20%20const%20userQueryRes%20%3D%20await%20fetch(%0A%20%20%20%20%20%20%20%20%60https%3A%2F%2Fwww.instagram.com%2Fweb%2Fsearch%2Ftopsearch%2F%3Fquery%3D%24%7Busername%7D%2F%60%0A%20%20%20%20%20%20)%3B%0A%0A%20%20%20%20%20%20const%20userQueryJson%20%3D%20await%20userQueryRes.json()%3B%0A%0A%20%20%20%20%20%20const%20userId%20%3D%20userQueryJson.users%5B0%5D.user.pk%3B%0A%0A%20%20%20%20%20%20let%20after%20%3D%20null%3B%0A%20%20%20%20%20%20let%20has_next%20%3D%20true%3B%0A%0A%20%20%20%20%20%20while%20(has_next)%20%7B%0A%20%20%20%20%20%20%20%20await%20fetch(%0A%20%20%20%20%20%20%20%20%20%20%60https%3A%2F%2Fwww.instagram.com%2Fgraphql%2Fquery%2F%3Fquery_hash%3Dc76146de99bb02f6415203be841dd25a%26variables%3D%60%20%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20encodeURIComponent(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20JSON.stringify(%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20id%3A%20userId%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20include_reel%3A%20true%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20fetch_mutual%3A%20true%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20first%3A%2050%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20after%3A%20after%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D)%0A%20%20%20%20%20%20%20%20%20%20%20%20)%0A%20%20%20%20%20%20%20%20)%0A%20%20%20%20%20%20%20%20%20%20.then((res)%20%3D%3E%20res.json())%0A%20%20%20%20%20%20%20%20%20%20.then((res)%20%3D%3E%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20has_next%20%3D%20res.data.user.edge_followed_by.page_info.has_next_page%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20after%20%3D%20res.data.user.edge_followed_by.page_info.end_cursor%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20followers%20%3D%20followers.concat(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20res.data.user.edge_followed_by.edges.map((%7B%20node%20%7D)%20%3D%3E%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20username%3A%20node.username%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20full_name%3A%20node.full_name%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D)%0A%20%20%20%20%20%20%20%20%20%20%20%20)%3B%0A%20%20%20%20%20%20%20%20%20%20%7D)%3B%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20after%20%3D%20null%3B%0A%20%20%20%20%20%20has_next%20%3D%20true%3B%0A%0A%20%20%20%20%20%20while%20(has_next)%20%7B%0A%20%20%20%20%20%20%20%20await%20fetch(%0A%20%20%20%20%20%20%20%20%20%20%60https%3A%2F%2Fwww.instagram.com%2Fgraphql%2Fquery%2F%3Fquery_hash%3Dd04b0a864b4b54837c0d870b0e77e076%26variables%3D%60%20%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20encodeURIComponent(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20JSON.stringify(%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20id%3A%20userId%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20include_reel%3A%20true%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20fetch_mutual%3A%20true%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20first%3A%2050%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20after%3A%20after%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D)%0A%20%20%20%20%20%20%20%20%20%20%20%20)%0A%20%20%20%20%20%20%20%20)%0A%20%20%20%20%20%20%20%20%20%20.then((res)%20%3D%3E%20res.json())%0A%20%20%20%20%20%20%20%20%20%20.then((res)%20%3D%3E%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20has_next%20%3D%20res.data.user.edge_follow.page_info.has_next_page%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20after%20%3D%20res.data.user.edge_follow.page_info.end_cursor%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20followings%20%3D%20followings.concat(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20res.data.user.edge_follow.edges.map((%7B%20node%20%7D)%20%3D%3E%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20username%3A%20node.username%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20full_name%3A%20node.full_name%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D)%0A%20%20%20%20%20%20%20%20%20%20%20%20)%3B%0A%20%20%20%20%20%20%20%20%20%20%7D)%3B%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20return%20%7B%0A%20%20%20%20%20%20%20%20followers%2C%0A%20%20%20%20%20%20%20%20followings%2C%0A%20%20%20%20%20%20%7D%3B%0A%20%20%20%20%7D%20catch%20(err)%20%7B%0A%20%20%20%20%20%20console.log(%7B%20err%20%7D)%3B%0A%20%20%20%20%7D%0A%20%20%7D%0A%0A%20%20async%20function%20makeGraph(centralUsername)%20%7B%0A%20%20%20%20console.log(%0A%20%20%20%20%20%20%60Getting%20user%20info%20for%20%24%7BcentralUsername%7D.%20This%20may%20take%20a%2015-20%20seconds...%60%0A%20%20%20%20)%3B%0A%0A%20%20%20%20const%20%7B%20followers%2C%20followings%20%7D%20%3D%20await%20getUserInfo(centralUsername)%3B%0A%20%20%20%20console.log(%7B%20followers%2C%20followings%20%7D)%3B%0A%20%20%20%20const%20graph%20%3D%20%7B%0A%20%20%20%20%20%20nodes%3A%20%5B%7B%20id%3A%20centralUsername%2C%20group%3A%201%20%7D%5D%2C%0A%20%20%20%20%20%20links%3A%20%5B%5D%2C%0A%20%20%20%20%7D%3B%0A%20%20%20%20followers.forEach((follower)%20%3D%3E%20%7B%0A%20%20%20%20%20%20graph.nodes.push(%7B%20id%3A%20follower.username%2C%20group%3A%201%20%7D)%3B%0A%20%20%20%20%20%20graph.links.push(%7B%0A%20%20%20%20%20%20%20%20source%3A%20follower.username%2C%0A%20%20%20%20%20%20%20%20target%3A%20centralUsername%2C%0A%20%20%20%20%20%20%20%20value%3A%201%2C%0A%20%20%20%20%20%20%7D)%3B%0A%20%20%20%20%7D)%3B%0A%20%20%20%20followings.forEach((following)%20%3D%3E%20%7B%0A%20%20%20%20%20%20graph.links.push(%7B%0A%20%20%20%20%20%20%20%20source%3A%20centralUsername%2C%0A%20%20%20%20%20%20%20%20target%3A%20following.username%2C%0A%20%20%20%20%20%20%20%20value%3A%201%2C%0A%20%20%20%20%20%20%7D)%3B%0A%0A%20%20%20%20%20%20const%20alreadyExists%20%3D%20graph.nodes.find(%0A%20%20%20%20%20%20%20%20(node)%20%3D%3E%20node.id%20%3D%3D%3D%20following.username%0A%20%20%20%20%20%20)%3B%0A%20%20%20%20%20%20if%20(alreadyExists)%20return%3B%0A%20%20%20%20%20%20graph.nodes.push(%7B%20id%3A%20following.username%2C%20group%3A%201%20%7D)%3B%0A%20%20%20%20%7D)%3B%0A%0A%20%20%20%20const%20graph1%20%3D%20%7B%0A%20%20%20%20%20%20nodes%3A%20%5B%0A%20%20%20%20%20%20%20%20%7B%20id%3A%20centralUsername%2C%20group%3A%201%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%20id%3A%20%22other%22%2C%20group%3A%201%20%7D%2C%0A%20%20%20%20%20%20%5D%2C%0A%20%20%20%20%20%20links%3A%20%5B%7B%20source%3A%20centralUsername%2C%20target%3A%20%22other%22%2C%20value%3A%201%20%7D%5D%2C%0A%20%20%20%20%7D%3B%0A%20%20%20%20return%20graph%3B%0A%20%20%7D%0A%0A%20%20function%20downloadData(data)%20%7B%0A%20%20%20%20const%20a%20%3D%20document.createElement(%22a%22)%3B%0A%20%20%20%20a.href%20%3D%20URL.createObjectURL(%0A%20%20%20%20%20%20new%20Blob(%5BJSON.stringify(data%2C%20null%2C%202)%5D%2C%20%7B%0A%20%20%20%20%20%20%20%20type%3A%20%22text%2Fplain%22%2C%0A%20%20%20%20%20%20%7D)%0A%20%20%20%20)%3B%0A%20%20%20%20a.setAttribute(%22download%22%2C%20%22ig-social-data.json%22)%3B%0A%20%20%20%20document.body.appendChild(a)%3B%0A%20%20%20%20a.click()%3B%0A%20%20%20%20document.body.removeChild(a)%3B%0A%20%20%7D%0A%0A%20%20const%20graph%20%3D%20await%20makeGraph(%22sebas.favaron%22)%3B%0A%20%20downloadData(graph)%3B%0A%7D)()%3B%7D)()%3B">Draw this to your bookmark folder</a></p>
        <div id="file-input-container" class="file-input-container">
            <input id="file" type="file" accept=".json" class="big-input">
            <label class="file-input-label">Drag file here</label>
        </div>
        <svg style="width:100%;height:100%;"></svg>
    </body>
    <script type="module" src="index.js"></script>
    <script type="module" src="uploadHandler.js"></script>
    <style>
        .file-input-container {
            position: relative;
        }
        .big-input {
            width:95%;
            height:90vh;
            padding: 12px 20px;
            margin: 8px 0;
            box-sizing: border-box;
            border: 2px solid #ccc;
            border-radius: 4px;
        }
        .file-input-label {
            position: absolute;
            font-size: 50px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            pointer-events: none;
        }
    </style>
</html>